<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
<title>VOC√ä N√ÉO ME CONHECE ‚Äî JEA</title>
<style>
:root {
  --bg: #030207;
  --accent: #9b7cff; 
  --text: #ffffff;
  --glass: rgba(255, 255, 255, 0.08);
  --success: #28a745;
  --danger: #dc3545;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', Roboto, sans-serif; height: 100dvh; overflow: hidden; display: flex; justify-content: center; }
#app { width: 100%; max-width: 480px; height: 100%; position: relative; display: flex; flex-direction: column; padding: 10px; }

.nav-top { position: absolute; top: 15px; left: 15px; right: 15px; z-index: 1000; display: flex; justify-content: space-between; }
.btn-nav { background: var(--glass); border: 1px solid rgba(255,255,255,0.2); color: #fff; width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }

.screen { display: none; flex-direction: column; width: 100%; height: 100%; padding: 10px; text-align: center; position: relative; }
.screen.active { display: flex; }

.player-row { display: flex; justify-content: space-between; align-items: center; background: var(--glass); padding: 12px 15px; border-radius: 15px; margin-bottom: 8px; }
.btn-remove { background: var(--danger); color: #fff; border: none; padding: 8px 15px; border-radius: 10px; font-size: 0.7rem; font-weight: 900; width: auto !important; }

.card-container { perspective: 1000px; margin: 20px 0; height: 180px; }
.card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
.card-inner.flipped { transform: rotateY(180deg); }
.card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 25px; display: flex; align-items: center; justify-content: center; padding: 25px; border: 2px solid var(--accent); }
.card-front { background: #1a1625; font-size: 3rem; color: var(--accent); }
.card-back { background: #251f35; transform: rotateY(180deg); font-size: 1.1rem; font-weight: 700; }

.res-card { border-radius: 15px; padding: 18px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; font-weight: 900; color: #fff; }
.res-card.win { background: var(--success); }
.res-card.lose { background: var(--danger); }

button { width: 100%; padding: 16px; border-radius: 18px; border: none; font-size: 0.9rem; font-weight: 900; text-transform: uppercase; cursor: pointer; transition: 0.2s; }
button:active { transform: scale(0.96); }
.btn-primary { background: #fff; color: #000; }
.btn-accent { background: var(--accent); color: #fff; }
.btn-outline { background: var(--glass); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
.btn-success { background: var(--success); color: #fff; }
.btn-danger { background: var(--danger); color: #fff; }

.modal { position: absolute; inset: 0; background: rgba(0,0,0,0.96); display: none; align-items: center; justify-content: center; padding: 20px; z-index: 2000; }
.modal-box { background: #111; padding: 25px; border-radius: 30px; border: 1px solid var(--accent); width: 100%; max-width: 400px; }
.score-row { display: flex; justify-content: space-between; align-items: center; background: var(--glass); padding: 12px; border-radius: 15px; margin-bottom: 8px; }
.adj-btn { width: 35px !important; padding: 5px !important; background: #333; color: #fff; border-radius: 8px; }
</style>
</head>
<body>

<div id="app">
  <div class="nav-top">
    <button class="btn-nav" id="sound-btn" onclick="toggleAudio()">üîä</button>
    <button class="btn-nav" onclick="openModal('modal-menu')">‚ò∞</button>
  </div>

  <div id="scr-setup" class="screen active">
    <h1 style="font-size:1.8rem; margin-top: 60px; color: var(--accent);">VOC√ä N√ÉO ME CONHECE</h1>
    <input id="in-name" placeholder="NOME DO JOGADOR" maxlength="15" style="width:100%; padding:18px; border-radius:15px; background:var(--glass); color:#fff; border:1px solid rgba(255,255,255,0.1); margin-bottom:10px; text-align:center; font-weight:900;">
    <button class="btn-accent" onclick="addPlayer()">+ ADICIONAR</button>
    <div id="player-list" style="overflow-y:auto; flex:1; margin: 15px 0;"></div>
    <button class="btn-primary" onclick="startGame()">INICIAR JOGO</button>
  </div>

  <div id="scr-lobby" class="screen">
    <h3 style="margin-top:70px">Vez de:</h3>
    <h1 id="lb-name" style="color:var(--accent); font-size:2.8rem; margin:10px 0">?</h1>
    <div style="margin: 20px 0; padding: 25px; background: var(--glass); border-radius: 25px;">
        <p style="margin:0; opacity:0.6; font-weight:700">MEUS PONTOS</p>
        <div id="lb-score" style="font-size: 3.5rem; font-weight: 1000; color: var(--accent);">0</div>
    </div>
    <button class="btn-outline" onclick="openScore()">üìä PLACAR GERAL</button>
    <div style="flex:1"></div>
    <button class="btn-primary" onclick="revealCard()">REVELAR CARTA</button>
  </div>

  <div id="scr-narrator-choice" class="screen">
    <h3 style="margin-top:60px" id="choice-title"></h3>
    <div class="card-container" onclick="flipCard()">
        <div class="card-inner" id="cardFlip">
            <div class="card-front">?</div>
            <div class="card-back" id="display-pergunta"></div>
        </div>
    </div>
    <div style="display:flex; flex-direction:column; gap:10px">
      <button class="btn-success" onclick="startStory(true)">VOU CONTAR UMA VERDADE</button>
      <button class="btn-danger" onclick="startStory(false)">VOU CONTAR UMA MENTIRA</button>
      <button id="btnSkip" class="btn-outline" onclick="skipQuestion()">üîÑ TROCAR CARTA (5)</button>
    </div>
  </div>

  <div id="scr-story-time" class="screen">
    <h3 style="margin-top:60px" id="story-narrator-name"></h3>
    <div id="timerText" style="font-size:4.5rem; font-weight:900; margin:20px 0">60</div>
    <div id="story-reminder" style="padding:20px; background:var(--glass); border-radius:20px; font-weight:bold"></div>
    <div style="flex:1"></div>
    <button class="btn-accent" onclick="startVotingSession()">INICIAR VOTA√á√ÉO</button>
  </div>

  <div id="scr-voting" class="screen">
    <h3 style="margin-top:80px">Vota√ß√£o Sigilosa</h3>
    <h2 style="color:var(--accent); font-size:2.2rem" id="voter-name"></h2>
    <p style="opacity:0.6">Passe o celular para este jogador</p>
    <div style="flex:1"></div>
    <div style="display:flex; flex-direction:column; gap:12px; margin-bottom:40px">
        <button class="btn-success" id="vote-v-btn" onclick="recordVote(true)"></button>
        <button class="btn-danger" id="vote-m-btn" onclick="recordVote(false)"></button>
    </div>
  </div>

  <div id="scr-result" class="screen">
    <h3 style="margin-top:50px" id="res-title"></h3>
    <h1 id="res-truth-label" style="font-size:3rem; margin:10px 0"></h1>
    <div id="res-bar-box" style="padding:20px; border-radius:25px; margin-bottom:20px">
        <div id="res-narrator-pts" style="font-size:3rem; font-weight:1000"></div>
        <div style="font-weight:900; font-size:0.8rem">PONTOS PARA O NARRADOR</div>
    </div>
    <div id="res-players-list" style="flex:1; overflow-y:auto;"></div>
    <button class="btn-primary" onclick="nextTurn()">PR√ìXIMA RODADA</button>
  </div>

  <div id="modal-score" class="modal">
    <div class="modal-box">
      <h2>PLACAR GERAL</h2>
      <button id="btnEditToggle" class="btn-outline" style="font-size:0.7rem; margin-bottom:15px" onclick="manualEdit = !manualEdit; renderScoreBody()">‚úèÔ∏è AJUSTAR PONTOS</button>
      <div id="score-body"></div>
      <button class="btn-primary" onclick="closeModal('modal-score')" style="margin-top:20px">VOLTAR</button>
    </div>
  </div>

  <div id="modal-rules" class="modal">
    <div class="modal-box" style="text-align: left;">
      <h2 style="color:var(--accent); text-align:center">REGRAS</h2>
      <p>‚Ä¢ O <b>Narrador</b> vira a carta e escolhe se contar√° uma Verdade ou Mentira.</p>
      <p>‚Ä¢ Os outros votam <b>individualmente</b> e em segredo.</p>
      <p>‚Ä¢ O narrador ganha 1 ponto por cada jogador enganado.</p>
      <p>‚Ä¢ Jogadores ganham 1 ponto se acertarem.</p>
      <button class="btn-accent" onclick="closeModal('modal-rules')" style="margin-top:15px">Entendi</button>
    </div>
  </div>

  <div id="modal-menu" class="modal"><div class="modal-box">
    <button class="btn-outline" onclick="closeModal('modal-menu'); openModal('modal-rules')" style="margin-bottom:10px">üìú Regras</button>
    <button class="btn-outline" onclick="location.reload()" style="margin-bottom:10px">üîÑ Reiniciar</button>
    <button class="btn-primary" onclick="window.location.href='./index.html'">üè† Voltar ao HUB</button>
    <button class="btn-accent" onclick="closeModal('modal-menu')" style="margin-top:20px">Fechar</button>
  </div></div>
</div>

<script>
const perguntas = ["Conte sobre um mico que j√° pagou.","Conte sobre algo que comprou e se arrependeu.","Conte sobre uma cicatriz.","Conte sobre um encontro que deu errado.","Conte sobre algo estranho que j√° comeu.","Conte sobre um presente ruim que ganhou."];
let players = [], deck = [], cur = 0, idx = 0, isNarratorTruth = true, currentQuestion = "", votes = {}, votingQueue = [], isMuted = false, audioCtx = null, time = 60, timeInt = null, manualEdit = false;

function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); if (audioCtx.state === 'suspended') audioCtx.resume(); }
function playSfx(freq, type='sine', dur=0.1) {
    if(isMuted || !audioCtx) return;
    const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
    o.type = type; o.connect(g); g.connect(audioCtx.destination);
    o.frequency.setValueAtTime(freq, audioCtx.currentTime);
    g.gain.setValueAtTime(0.1, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + dur);
    o.start(); o.stop(audioCtx.currentTime + dur);
}

function addPlayer(){
  const inp = document.getElementById("in-name");
  if(!inp.value.trim()) return;
  initAudio();
  players.push({name: inp.value.toUpperCase(), score: 0, skips: 5});
  renderSetupPlayers(); inp.value = ""; 
  playSfx(880, 'sine', 0.2); 
}

function removePlayer(i){
    players.splice(i,1);
    renderSetupPlayers();
    playSfx(150, 'square', 0.1); 
}

function renderSetupPlayers(){
  document.getElementById("player-list").innerHTML = players.map((p,i)=>`
    <div class="player-row">
        <span style="flex:1; text-align:left; font-weight:700">${p.name}</span>
        <button class="btn-remove" onclick="removePlayer(${i})">Remover</button>
    </div>`).join("");
}

function startGame(){
  if(players.length < 2) return;
  initAudio();
  playSfx(400); setTimeout(()=>playSfx(600), 100); setTimeout(()=>playSfx(800), 200); 
  deck = [...perguntas].sort(()=>Math.random()-0.5);
  show("scr-lobby"); updateLobby();
}

function updateLobby(){ 
    document.getElementById("lb-name").innerText = players[cur].name; 
    document.getElementById("lb-score").innerText = players[cur].score; 
}

function revealCard(){
  currentQuestion = deck[idx % deck.length];
  document.getElementById("cardFlip").classList.remove("flipped");
  document.getElementById("choice-title").innerText = "Vez de " + players[cur].name;
  document.getElementById("display-pergunta").innerText = currentQuestion;
  document.getElementById("btnSkip").innerText = `üîÑ TROCAR CARTA (${players[cur].skips})`;
  show("scr-narrator-choice");
}

function flipCard() { document.getElementById("cardFlip").classList.add("flipped"); playSfx(600); }
function skipQuestion(){ if(players[cur].skips > 0){ players[cur].skips--; idx++; revealCard(); playSfx(200); } }

function startStory(isTruth){
  isNarratorTruth = isTruth; time = 60;
  playSfx(440, 'sine', 0.1); 
  document.getElementById("story-narrator-name").innerText = "VEZ DE " + players[cur].name;
  document.getElementById("story-reminder").innerText = currentQuestion;
  show("scr-story-time");
  clearInterval(timeInt);
  timeInt = setInterval(()=>{
    time--; document.getElementById("timerText").innerText = time;
    if(time <= 0) startVotingSession();
  }, 1000);
}

function startVotingSession(){
    clearInterval(timeInt);
    votingQueue = players.map((_, i) => i).filter(i => i !== cur);
    document.getElementById("vote-v-btn").innerText = players[cur].name + " CONTOU UMA VERDADE";
    document.getElementById("vote-m-btn").innerText = players[cur].name + " CONTOU UMA MENTIRA";
    nextVoter();
}

function nextVoter(){
    if(votingQueue.length > 0){
        document.getElementById("voter-name").innerText = players[votingQueue[0]].name;
        show("scr-voting");
    } else calculateResult();
}

function recordVote(vote){
    votes[votingQueue.shift()] = vote;
    playSfx(700);
    if(votingQueue.length > 0) {
        document.getElementById("voter-name").innerText = "PR√ìXIMO...";
        setTimeout(nextVoter, 200); 
    } else calculateResult();
}

function calculateResult(){
  let errouCount = 0, resultHTML = "";
  players.forEach((p, i) => {
    if(i === cur) return;
    if(votes[i] === isNarratorTruth) { 
        p.score++; resultHTML += `<div class="res-card win"><span>${p.name}</span> <span>ACERTOU</span></div>`; 
    } else { 
        errouCount++; resultHTML += `<div class="res-card lose"><span>${p.name}</span> <span>ERROU</span></div>`; 
    }
  });
  players[cur].score += errouCount;
  document.getElementById("res-title").innerText = players[cur].name + " CONTOU UMA...";
  document.getElementById("res-truth-label").innerText = isNarratorTruth ? "VERDADE" : "MENTIRA";
  const bar = document.getElementById("res-bar-box");
  bar.style.background = isNarratorTruth ? "var(--success)" : "var(--danger)";
  document.getElementById("res-narrator-pts").innerText = "+" + errouCount;
  document.getElementById("res-players-list").innerHTML = resultHTML;
  show("scr-result");
}

function nextTurn(){ cur = (cur + 1) % players.length; idx++; updateLobby(); show("scr-lobby"); }
function openModal(id){ document.getElementById(id).style.display = "flex"; }
function closeModal(id){ document.getElementById(id).style.display = "none"; }
function show(id){ document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active")); document.getElementById(id).classList.add("active"); }
function toggleAudio() { initAudio(); isMuted = !isMuted; document.getElementById("sound-btn").innerText = isMuted ? "üîá" : "üîä"; }
function openScore(){ manualEdit = false; renderScoreBody(); openModal("modal-score"); }
function renderScoreBody(){
  document.getElementById("score-body").innerHTML = players.map((p,i)=>`
    <div class="score-row">
      <b style="flex:1; text-align:left">${p.name}</b>
      <div style="display:flex; align-items:center; gap:10px">
        ${manualEdit ? `<button class="adj-btn" onclick="adjP(${i},-1)">-</button>` : ''}
        <span style="color:var(--accent); font-weight:900; min-width:20px">${p.score}</span>
        ${manualEdit ? `<button class="adj-btn" onclick="adjP(${i},1)">+</button>` : ''}
      </div>
    </div>`).join("");
}
function adjP(i,v){ players[i].score = Math.max(0, players[i].score+v); renderScoreBody(); updateLobby(); }
</script>
</body>
</html>
