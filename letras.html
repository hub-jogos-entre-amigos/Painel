<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
<title>Cad√™ as Letras? ‚Äî JEA</title>
<style>
:root {
  --bg: #030207;
  --accent: #9b7cff; 
  --text: #ffffff;
  --glass: rgba(255, 255, 255, 0.08);
  --success: #2dd36f;
  --warning: #ffcc00;
  --danger: #ff3b3b;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', Roboto, sans-serif; height: 100dvh; overflow: hidden; display: flex; justify-content: center; }
#app { width: 100%; max-width: 480px; height: 100%; position: relative; display: flex; flex-direction: column; padding: 10px; }

/* NAV */
.nav-top { position: absolute; top: 15px; left: 15px; right: 15px; z-index: 1000; display: flex; justify-content: space-between; }
.btn-nav { background: var(--glass); border: 1px solid rgba(255,255,255,0.2); color: #fff; width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }

.screen { display: none; flex-direction: column; width: 100%; height: 100%; padding: 10px; text-align: center; position: relative; }
.screen.active { display: flex; }

/* SETUP - RESTAURADO CONFORME APROVADO */
.player-row { display: flex; justify-content: space-between; align-items: center; background: var(--glass); padding: 12px 15px; border-radius: 15px; margin-bottom: 8px; }
.btn-remove { background: var(--danger); color: #fff; border: none; padding: 8px 15px; border-radius: 10px; font-size: 0.7rem; font-weight: 900; width: auto !important; }

/* CARTA TEMA */
.card-container { perspective: 1000px; margin: 40px auto; width: 80%; height: 140px; }
.card-inner { position: relative; width: 100%; height: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
.card-inner.flipped { transform: rotateY(180deg); }
.card-front, .card-back { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; display: flex; align-items: center; justify-content: center; padding: 20px; border: 2px solid var(--accent); }
.card-front { background: #1a1625; font-size: 2rem; color: var(--accent); font-weight: 900; }
.card-back { background: #251f35; transform: rotateY(180deg); font-size: 1.5rem; font-weight: 900; color: #fff; text-transform: uppercase; }

/* JOGO */
.tema-fixo { background: var(--accent); color: #000; padding: 10px; border-radius: 0 0 15px 15px; font-weight: 900; margin: -10px -10px 10px -10px; text-transform: uppercase; }
.players-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.p-btn { background: var(--glass); border: 1px solid rgba(255,255,255,0.1); color: #fff; padding: 12px; border-radius: 15px; font-weight: 900; font-size: 0.8rem; transition: 0.2s; }
.p-btn.active { background: var(--success); box-shadow: 0 0 15px var(--success); }
.p-btn:disabled { opacity: 0.2; }

/* RODA */
.wheel-container { position: relative; width: 320px; height: 320px; margin: auto; flex-shrink: 0; }
.letra-node {
    position: absolute; width: 44px; height: 44px; background: #1a1625; border: 2px solid var(--accent);
    border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center;
    font-weight: 900; transition: 0.3s; z-index: 10;
}
.letra-node span { font-size: 0.5rem; opacity: 0.6; }
.letra-node.taken { transform: scale(0); opacity: 0; pointer-events: none; }

#pop-score {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
    background: var(--accent); color: #000; padding: 15px; border-radius: 50%; width: 100px; height: 100px;
    display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: 900; z-index: 100; pointer-events: none;
}
#pop-score.show { transform: translate(-50%, -50%) scale(1); }

/* TIMER BAR */
.timer-box { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; margin: 10px 0; overflow: hidden; }
#timer-fill { height: 100%; background: var(--success); width: 100%; transition: width 0.1s linear, background 0.5s; }

/* GERAL */
button { width: 100%; padding: 16px; border-radius: 18px; border: none; font-size: 0.85rem; font-weight: 900; text-transform: uppercase; cursor: pointer; }
.btn-primary { background: #fff; color: #000; }
.btn-accent { background: var(--accent); color: #fff; }
.btn-outline { background: var(--glass); color: #fff; border: 1px solid rgba(255,255,255,0.2); }

.modal { position: absolute; inset: 0; background: rgba(0,0,0,0.96); display: none; align-items: center; justify-content: center; padding: 20px; z-index: 2000; }
.modal-box { background: #111; padding: 25px; border-radius: 30px; border: 1px solid var(--accent); width: 100%; max-width: 400px; }
</style>
</head>
<body>

<div id="app">
  <div class="nav-top">
    <button class="btn-nav" id="sound-btn" onclick="toggleAudio()">üîä</button>
    <button class="btn-nav" onclick="openModal('modal-menu')">‚ò∞</button>
  </div>

  <div id="scr-setup" class="screen active">
    <h1 style="margin-top:60px; color:var(--accent)">CAD√ä AS LETRAS?</h1>
    <input id="in-name" placeholder="NOME DO JOGADOR" maxlength="15" style="width:100%; padding:18px; border-radius:15px; background:var(--glass); color:#fff; border:1px solid rgba(255,255,255,0.1); margin-bottom:10px; text-align:center; font-weight:900;">
    <button class="btn-accent" onclick="addPlayer()">+ ADICIONAR</button>
    <div id="player-list" style="overflow-y:auto; flex:1; margin: 15px 0;"></div>
    <button class="btn-primary" onclick="prepareRound()">INICIAR JOGO</button>
  </div>

  <div id="scr-pre" class="screen">
    <h2 style="margin-top:70px; opacity:0.6">O TEMA √â...</h2>
    <div class="card-container">
        <div class="card-inner" id="themeCard">
            <div class="card-front">?</div>
            <div class="card-back" id="display-tema-pre">---</div>
        </div>
    </div>
    <div style="flex:1"></div>
    <div style="display:flex; flex-direction:column; gap:10px; margin-bottom:30px">
        <button class="btn-outline" onclick="drawTema()">üîÑ TROCAR TEMA</button>
        <button class="btn-accent" onclick="startGame()">INICIAR RODADA</button>
    </div>
  </div>

  <div id="scr-game" class="screen">
    <div class="tema-fixo" id="tema-topo">---</div>
    <div id="players-top" class="players-grid"></div>
    <div class="wheel-container">
        <div id="pop-score"></div>
        <div id="wheel" style="width:100%; height:100%"></div>
    </div>
    <div id="players-bottom" class="players-grid"></div>
    <div class="timer-box"><div id="timer-fill"></div></div>
    <button class="btn-outline" style="font-size:0.7rem; padding:10px; border-color:var(--danger); color:var(--danger);" onclick="undoLastMove()">‚ö†Ô∏è ANULAR JOGADA</button>
  </div>

  <div id="modal-menu" class="modal"><div class="modal-box">
    <button class="btn-outline" onclick="closeModal('modal-menu'); openModal('modal-rules')" style="margin-bottom:10px">üìú Regras</button>
    <button class="btn-outline" onclick="location.reload()" style="margin-bottom:10px">üîÑ Reiniciar Tudo</button>
    <button class="btn-primary" onclick="window.location.href='./index.html'">üè† HUB</button>
    <button class="btn-accent" onclick="closeModal('modal-menu')" style="margin-top:20px">Fechar</button>
  </div></div>

  <div id="modal-rules" class="modal"><div class="modal-box">
    <h2 style="color:var(--accent)">REGRAS</h2>
    <p>‚Ä¢ Clique no seu nome: voc√™ tem 3s de vez.</p>
    <p>‚Ä¢ Clique na letra do que voc√™ falou.</p>
    <p>‚Ä¢ O bot√£o ANULAR devolve a letra e tira o ponto se a palavra for inv√°lida.</p>
    <button class="btn-accent" onclick="closeModal('modal-rules')">ENTENDI</button>
  </div></div>

  <div id="modal-score" class="modal"><div class="modal-box">
    <h2 style="color:var(--accent)">PLACAR</h2>
    <div id="score-body"></div>
    <button class="btn-accent" onclick="prepareRound()" style="margin-top:20px">PR√ìXIMA RODADA</button>
  </div></div>
</div>

<script>
const alfabeto = [
  {l:'A', p:1}, {l:'B', p:3}, {l:'C', p:2}, {l:'D', p:2}, {l:'E', p:1}, {l:'F', p:4}, {l:'G', p:4}, {l:'H', p:4},
  {l:'I', p:1}, {l:'J', p:5}, {l:'L', p:2}, {l:'M', p:3}, {l:'N', p:3}, {l:'O', p:1}, {l:'P', p:3}, {l:'Q', p:6},
  {l:'R', p:2}, {l:'S', p:2}, {l:'T', p:2}, {l:'U', p:1}, {l:'V', p:4}, {l:'X', p:8}, {l:'Z', p:8}, {l:'K', p:7},
  {l:'W', p:7}, {l:'Y', p:7}
];
const temas = ["ANIMAIS","MARCAS","OBJETOS","FRUTAS","CORES","FILMES","PA√çSES","COMIDAS","PROFISS√ïES","CIDADES"];

let players = [], activeIdx = null, lockTimer = null, globalTimer = null, isMuted = false, audioCtx = null;
let currentTema = "", history = [], timeLeft = 60;

function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
function playSfx(f, d=0.1, t='sine') { if(isMuted || !audioCtx) return; const o=audioCtx.createOscillator(), g=audioCtx.createGain(); o.type=t; o.connect(g); g.connect(audioCtx.destination); o.frequency.setValueAtTime(f, audioCtx.currentTime); g.gain.setValueAtTime(0.1, audioCtx.currentTime); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime+d); o.start(); o.stop(audioCtx.currentTime+d); }

function addPlayer(){
    const inp = document.getElementById("in-name");
    if(!inp.value.trim()) return;
    initAudio();
    players.push({name: inp.value.toUpperCase(), score: 0});
    inp.value = ""; renderSetup();
    playSfx(880);
}

function renderSetup(){
    document.getElementById("player-list").innerHTML = players.map((p,i)=>`
        <div class="player-row">
            <b>${p.name}</b>
            <button class="btn-remove" onclick="players.splice(${i},1);renderSetup();playSfx(150);">REMOVER</button>
        </div>
    `).join("");
}

function prepareRound(){
    if(players.length < 2) { alert("Adicione pelo menos 2 jogadores!"); return; }
    closeModal('modal-score');
    drawTema();
    show("scr-pre");
}

function drawTema(){
    const card = document.getElementById("themeCard");
    card.classList.remove("flipped");
    playSfx(400);
    setTimeout(() => {
        currentTema = temas[Math.floor(Math.random()*temas.length)];
        document.getElementById("display-tema-pre").innerText = currentTema;
        document.getElementById("tema-topo").innerText = currentTema;
        card.classList.add("flipped");
        playSfx(900);
    }, 600);
}

function startGame(){
    initAudio();
    history = [];
    renderBoard();
    initWheel();
    show("scr-game");
    
    timeLeft = 60;
    const fill = document.getElementById("timer-fill");
    
    globalTimer = setInterval(() => {
        timeLeft -= 0.1;
        fill.style.width = (timeLeft/60)*100 + "%";
        
        // Timer Bips e Cores
        if(timeLeft <= 10) { 
            fill.style.background = "var(--danger)"; 
            if(Math.round(timeLeft*10)%5==0) playSfx(1200, 0.05, 'square'); 
        }
        else if(timeLeft <= 30) { 
            fill.style.background = "var(--warning)"; 
            if(Math.round(timeLeft*10)%10==0) playSfx(600, 0.05); 
        }
        else { 
            fill.style.background = "var(--success)"; 
            if(Math.round(timeLeft*10)%10==0) playSfx(440, 0.03); 
        }

        if(timeLeft <= 0){ clearInterval(globalTimer); endRound(); }
    }, 100);
}

function renderBoard(){
    const mid = Math.ceil(players.length / 2);
    const top = players.slice(0, mid), bot = players.slice(mid);
    const h = (p,i,off) => `<button class="p-btn" id="p-${i+off}" onclick="claimTurn(${i+off})">${p.name}<br><span id="s-${i+off}">${p.score} PTS</span></button>`;
    document.getElementById("players-top").innerHTML = top.map((p,i)=>h(p,i,0)).join("");
    document.getElementById("players-bottom").innerHTML = bot.map((p,i)=>h(p,i,mid)).join("");
}

function claimTurn(idx){
    if(activeIdx !== null) return;
    activeIdx = idx;
    playSfx(1000);
    document.querySelectorAll(".p-btn").forEach(b => b.disabled = true);
    document.getElementById(`p-${idx}`).disabled = false;
    document.getElementById(`p-${idx}`).classList.add("active");
    lockTimer = setTimeout(releaseTurn, 3000);
}

function releaseTurn(){
    clearTimeout(lockTimer);
    if(activeIdx !== null && document.getElementById(`p-${activeIdx}`)) document.getElementById(`p-${activeIdx}`).classList.remove("active");
    document.querySelectorAll(".p-btn").forEach(b => b.disabled = false);
    activeIdx = null;
}

function initWheel(){
    const wheel = document.getElementById("wheel");
    wheel.innerHTML = "";
    alfabeto.forEach((item, i) => {
        const isExt = i < 16, total = isExt ? 16 : 10, rad = isExt ? 135 : 75;
        const angle = (i * (360/total)) * (Math.PI/180);
        const x = 160 + rad * Math.cos(angle) - 22, y = 160 + rad * Math.sin(angle) - 22;
        const div = document.createElement("div");
        div.className = "letra-node";
        div.id = `letra-${i}`;
        div.style.left = x+"px"; div.style.top = y+"px";
        div.innerHTML = `${item.l}<span>${item.p}</span>`;
        div.onclick = () => { if(activeIdx !== null) {
            players[activeIdx].score += item.p;
            div.classList.add("taken");
            history.push({ playerIdx: activeIdx, letraIdx: i, points: item.p });
            
            const pop = document.getElementById("pop-score");
            pop.innerHTML = `<span style="font-size:0.6rem">${players[activeIdx].name}</span>+${item.p}`;
            pop.classList.add("show");
            playSfx(1200, 0.2);
            document.getElementById(`s-${activeIdx}`).innerText = `${players[activeIdx].score} PTS`;
            setTimeout(() => { pop.classList.remove("show"); releaseTurn(); }, 500);
        }};
        wheel.appendChild(div);
    });
}

function undoLastMove(){
    if(history.length === 0) return;
    const last = history.pop();
    players[last.playerIdx].score -= last.points;
    document.getElementById(`letra-${last.letraIdx}`).classList.remove("taken");
    document.getElementById(`s-${last.playerIdx}`).innerText = `${players[last.playerIdx].score} PTS`;
    playSfx(200, 0.3, 'sawtooth');
}

function endRound(){
    releaseTurn();
    playSfx(200, 0.5, 'square');
    const ranked = [...players].sort((a,b) => b.score - a.score);
    document.getElementById("score-body").innerHTML = ranked.map(p => `<div class="player-row"><b>${p.name}</b><span>${p.score} PTS</span></div>`).join("");
    document.getElementById("modal-score").style.display = "flex";
}

function show(id){ document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active")); document.getElementById(id).classList.add("active"); }
function openModal(id){ document.getElementById(id).style.display = "flex"; }
function closeModal(id){ document.getElementById(id).style.display = "none"; }
function toggleAudio() { initAudio(); isMuted = !isMuted; document.getElementById("sound-btn").innerText = isMuted ? "üîá" : "üîä"; }
</script>
</body>
</html>
