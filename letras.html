<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
<title>Cad√™ as Letras? ‚Äî JEA</title>
<style>
:root {
  --bg: #030207;
  --accent: #9b7cff; 
  --text: #ffffff;
  --glass: rgba(255, 255, 255, 0.08);
  --success: #2dd36f;
  --warning: #ffcc00;
  --danger: #ff3b3b;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', Roboto, sans-serif; height: 100dvh; overflow: hidden; display: flex; justify-content: center; align-items: center; }

/* --- ESTILOS VINHETA --- */
#scr-teaser {
    position: fixed; inset: 0; z-index: 9999;
    background: radial-gradient(circle at center, #1a1625 0%, #030207 100%);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 30px; text-align: center; cursor: pointer;
}
.tap-hint { position: absolute; font-size: 1rem; text-transform: uppercase; letter-spacing: 3px; font-weight: 800; color: var(--accent); animation: blink 2s infinite; z-index: 10; }
.teaser-content { display: none; flex-direction: column; align-items: center; }
.teaser-content.active { display: flex; }
.flip-icon-teaser { font-size: 8rem; filter: drop-shadow(0 0 30px var(--accent)); animation: flipAnim 6s cubic-bezier(0.4, 0, 0.2, 1) forwards; }
@keyframes flipAnim {
    0% { transform: rotateY(0deg) scale(0.5); opacity: 0; }
    15% { transform: rotateY(180deg) scale(1.1); opacity: 1; }
    100% { transform: rotateY(1800deg) scale(1); opacity: 1; }
}
.teaser-title { font-size: 2.8rem; font-weight: 1000; letter-spacing: 1px; color: var(--accent); margin-top: 20px; text-shadow: 0 0 20px rgba(155, 124, 255, 0.4); opacity: 0; }
.teaser-title.show { animation: fadeIn 1s forwards; }
.teaser-phrase { font-size: 1.1rem; line-height: 1.5; max-width: 340px; color: rgba(255,255,255,0.8); margin-top: 15px; opacity: 0; }
.teaser-phrase.show { animation: fadeIn 1.2s forwards; }

/* --- ESTILOS JOGO ORIGINAL --- */
#app { width: 100%; max-width: 480px; height: 100%; position: relative; display: none; flex-direction: column; padding: 10px; }
.nav-top { position: absolute; top: 15px; left: 15px; right: 15px; z-index: 1000; display: flex; justify-content: space-between; }
.btn-nav { background: var(--glass); border: 1px solid rgba(255,255,255,0.2); color: #fff; width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
.screen { display: none; flex-direction: column; width: 100%; height: 100%; padding: 10px; text-align: center; position: relative; }
.screen.active { display: flex; }
.player-row { display: flex; justify-content: space-between; align-items: center; background: var(--glass); padding: 12px 15px; border-radius: 15px; margin-bottom: 8px; }
.btn-remove { background: var(--danger); color: #fff; border: none; padding: 8px 15px; border-radius: 10px; font-size: 0.7rem; font-weight: 900; width: auto !important; }
.wheel-container { position: relative; width: 320px; height: 320px; margin: 40px auto; display: flex; align-items: center; justify-content: center; }
.letra-btn { position: absolute; width: 50px; height: 50px; border-radius: 50%; background: var(--glass); border: 1px solid rgba(255,255,255,0.1); color: #fff; font-weight: 900; font-size: 1.2rem; display: flex; align-items: center; justify-content: center; transition: 0.3s; cursor: pointer; }
.letra-btn.taken { background: #333; color: #666; opacity: 0.3; pointer-events: none; border: none; }
.letra-btn.active { border: 2px solid var(--accent); box-shadow: 0 0 15px var(--accent); transform: scale(1.1); }
#central-info { width: 130px; height: 130px; background: #111; border-radius: 50%; border: 2px solid var(--accent); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
button { width: 100%; padding: 16px; border-radius: 18px; border: none; font-size: 0.9rem; font-weight: 900; text-transform: uppercase; cursor: pointer; transition: 0.2s; }
.btn-primary { background: #fff; color: #000; }
.btn-accent { background: var(--accent); color: #fff; }
.btn-outline { background: var(--glass); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
.modal { position: absolute; inset: 0; background: rgba(0,0,0,0.96); display: none; align-items: center; justify-content: center; padding: 20px; z-index: 2000; }
.modal-box { background: #111; padding: 25px; border-radius: 30px; border: 1px solid var(--accent); width: 100%; max-width: 400px; }
.score-pop { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 5rem; font-weight: 900; color: var(--success); opacity: 0; pointer-events: none; transition: 0.5s; z-index: 3000; }
.score-pop.show { opacity: 1; transform: translate(-50%, -80%); }

@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
@keyframes blink { 0%, 100% { opacity: 0.2; } 50% { opacity: 1; } }
</style>
</head>
<body>

<div id="scr-teaser" onclick="iniciarTeaser()">
    <div class="tap-hint" id="hint">Toque para encontrar as letras</div>
    <div class="teaser-content" id="content-teaser">
        <div class="flip-icon-teaser">üî§</div>
        <div class="teaser-title" id="t-title">CAD√ä AS LETRAS?</div>
        <div class="teaser-phrase" id="t-phrase">Onde o alfabeto √© o seu maior inimigo. <br>Pense r√°pido, fale primeiro ou perca tudo.</div>
    </div>
</div>

<div id="app">
    <div class="nav-top">
        <button class="btn-nav" id="sound-btn" onclick="toggleAudio()">üîä</button>
        <button class="btn-nav" onclick="openModal('modal-menu')">‚ò∞</button>
    </div>

    <div id="scr-setup" class="screen active">
        <h1 style="margin-top: 60px; color: var(--accent);">CAD√ä AS LETRAS?</h1>
        <input id="in-name" placeholder="NOME DO JOGADOR" maxlength="15" style="width:100%; padding:18px; border-radius:15px; background:var(--glass); color:#fff; border:1px solid rgba(255,255,255,0.1); margin-bottom:10px; text-align:center; font-weight:900;">
        <button class="btn-accent" onclick="addPlayer()">+ ADICIONAR</button>
        <div id="player-list" style="overflow-y:auto; flex:1; margin: 15px 0;"></div>
        <button class="btn-primary" onclick="startGame()">INICIAR JOGO</button>
    </div>

    <div id="scr-game" class="screen">
        <div id="turn-indicator" style="margin-top: 60px; font-weight: 900; font-size: 1.2rem; color: var(--accent);">AGUARDANDO...</div>
        <div class="wheel-container" id="wheel">
            <div id="central-info">
                <span id="timer-label" style="font-size: 0.6rem; opacity: 0.6;">TEMPO</span>
                <span id="timer-val" style="font-size: 2.5rem; font-weight: 900;">10</span>
            </div>
        </div>
        <div id="player-scores" style="display:flex; justify-content:center; gap:10px; margin-bottom:20px"></div>
        <button class="btn-outline" onclick="undoLastMove()" style="margin-bottom:10px">‚Ü© DESFAZER √öLTIMA</button>
        <button class="btn-danger" onclick="endRound()">ENCERRAR RODADA</button>
    </div>

    <div id="score-pop" class="score-pop">+1</div>

    <div id="modal-menu" class="modal"><div class="modal-box"><h2>MENU</h2><button class="btn-outline" onclick="closeModal('modal-menu'); openModal('modal-rules')" style="margin-bottom:10px">üìú Regras</button><button class="btn-outline" onclick="location.reload()" style="margin-bottom:10px">üîÑ Reiniciar</button><button class="btn-primary" onclick="window.location.href='./index.html'">üè† Voltar ao HUB</button><button class="btn-accent" onclick="closeModal('modal-menu')" style="margin-top:20px">Fechar</button></div></div>
    <div id="modal-rules" class="modal"><div class="modal-box"><h2>REGRAS</h2><p style="text-align:left; font-size:0.9rem">‚Ä¢ Escolha uma categoria.<br>‚Ä¢ O jogador tem 10s para falar algo com a letra.<br>‚Ä¢ Se falar, toca na letra e ganha ponto.<br>‚Ä¢ Se o tempo acabar, a vez passa.</p><button class="btn-accent" onclick="closeModal('modal-rules')">ENTENDI</button></div></div>
    <div id="modal-score" class="modal"><div class="modal-box"><h2>RESULTADO FINAL</h2><div id="score-body"></div><button class="btn-primary" onclick="location.reload()" style="margin-top:20px">JOGAR NOVAMENTE</button></div></div>
</div>

<script>
let audioCtx = null;
let iniciadoTeaser = false;

// CORRE√á√ÉO: Fun√ß√£o de Teaser agora garante a transi√ß√£o para o jogo
function iniciarTeaser() {
    if (iniciadoTeaser) return;
    iniciadoTeaser = true;
    
    document.getElementById('hint').style.display = 'none';
    document.getElementById('content-teaser').classList.add('active');

    // Desbloqueia o contexto de √°udio
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    // Sons da vinheta
    for(let i=0; i<3; i++) {
        let t = i*0.15;
        playS(440 + (i*220), 'square', 0.1, t, 0.06);
    }

    setTimeout(() => {
        document.getElementById('t-title').classList.add('show');
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'triangle';
        osc.frequency.setValueAtTime(400, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(1500, audioCtx.currentTime + 2);
        gain.gain.setValueAtTime(0, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.07, audioCtx.currentTime + 0.1);
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 2);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + 2);
    }, 1200);

    setTimeout(() => { document.getElementById('t-phrase').classList.add('show'); }, 2500);
    setTimeout(() => { playS(1800, 'sine', 0.5, 0, 0.1); }, 4500);

    // CRUCIAL: Muda para a tela do jogo ap√≥s a vinheta acabar
    setTimeout(() => {
        document.getElementById('scr-teaser').style.display = 'none';
        document.getElementById('app').style.display = 'flex';
    }, 6500);
}

function playS(f, t='sine', d=0.1, delay=0, vol=0.1) {
    const time = audioCtx.currentTime + delay;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = t; o.frequency.setValueAtTime(f, time);
    g.gain.setValueAtTime(vol, time);
    g.gain.exponentialRampToValueAtTime(0.0001, time + d);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(time); o.stop(time + d);
}

// L√ìGICA DO JOGO ORIGINAL
const letras = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
let players = [], activeIdx = 0, timer = 10, timerInt = null, isMuted = false, history = [];

function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); if (audioCtx.state === 'suspended') audioCtx.resume(); }

function playSfx(f, d=0.1, type='sine') {
    if(isMuted || !audioCtx) return;
    const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
    o.type = type; o.connect(g); g.connect(audioCtx.destination);
    o.frequency.setValueAtTime(f, audioCtx.currentTime);
    g.gain.setValueAtTime(0.1, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d);
    o.start(); o.stop(audioCtx.currentTime + d);
}

function addPlayer(){
    const inp = document.getElementById("in-name");
    if(!inp.value.trim()) return;
    initAudio();
    players.push({name: inp.value.toUpperCase(), score: 0});
    renderSetupPlayers(); inp.value = "";
    playSfx(800);
}

function renderSetupPlayers(){
    document.getElementById("player-list").innerHTML = players.map((p,i)=>`
        <div class="player-row"><span>${p.name}</span><button class="btn-remove" onclick="players.splice(${i},1);renderSetupPlayers()">Remover</button></div>`).join("");
}

function startGame(){
    if(players.length < 2) return alert("M√≠nimo 2 jogadores");
    initAudio();
    renderWheel();
    document.getElementById("player-scores").innerHTML = players.map((p,i)=>`
        <div style="background:var(--glass); padding:10px; border-radius:12px; font-size:0.7rem; font-weight:900">
            ${p.name}<br><span id="s-${i}" style="color:var(--accent); font-size:1rem">0 PTS</span>
        </div>`).join("");
    show("scr-game");
    releaseTurn();
}

function releaseTurn(){
    clearInterval(timerInt);
    document.getElementById("turn-indicator").innerText = `VEZ DE: ${players[activeIdx].name}`;
    timer = 10;
    document.getElementById("timer-val").innerText = timer;
    document.getElementById("timer-val").style.color = "#fff";
    document.querySelectorAll(".letra-btn").forEach(b => b.classList.remove("active"));
    const disponiveis = [...document.querySelectorAll(".letra-btn:not(.taken)")];
    if(disponiveis.length === 0) return endRound();
    const sorteada = disponiveis[Math.floor(Math.random() * disponiveis.length)];
    sorteada.classList.add("active");
    timerInt = setInterval(() => {
        timer--;
        document.getElementById("timer-val").innerText = timer;
        if(timer <= 3) { document.getElementById("timer-val").style.color = "#ff3b3b"; playSfx(400, 0.05); }
        if(timer <= 0) {
            clearInterval(timerInt);
            playSfx(200, 0.3, 'sawtooth');
            activeIdx = (activeIdx + 1) % players.length;
            setTimeout(releaseTurn, 1000);
        }
    }, 1000);
}

function renderWheel(){
    const wheel = document.getElementById("wheel");
    const radius = 135;
    letras.forEach((l, i) => {
        const angle = (i / letras.length) * Math.PI * 2 - Math.PI/2;
        const x = Math.cos(angle) * radius + 160 - 25;
        const y = Math.sin(angle) * radius + 160 - 25;
        const div = document.createElement("div");
        div.className = "letra-btn";
        div.id = `letra-${i}`; div.innerText = l;
        div.style.left = `${x}px`; div.style.top = `${y}px`;
        div.onclick = () => { if(div.classList.contains("active")){
            clearInterval(timerInt);
            div.classList.remove("active"); div.classList.add("taken");
            players[activeIdx].score++;
            history.push({letraIdx: i, playerIdx: activeIdx, points: 1});
            const pop = document.getElementById("score-pop");
            pop.classList.add("show");
            playSfx(1200, 0.2);
            document.getElementById(`s-${activeIdx}`).innerText = `${players[activeIdx].score} PTS`;
            setTimeout(() => { pop.classList.remove("show"); releaseTurn(); }, 500);
        }};
        wheel.appendChild(div);
    });
}

function undoLastMove(){
    if(history.length === 0) return;
    const last = history.pop();
    players[last.playerIdx].score -= last.points;
    document.getElementById(`letra-${last.letraIdx}`).classList.remove("taken");
    document.getElementById(`s-${last.playerIdx}`).innerText = `${players[last.playerIdx].score} PTS`;
    playSfx(200, 0.3, 'sawtooth');
}

function endRound(){
    clearInterval(timerInt);
    playSfx(200, 0.5, 'square');
    const ranked = [...players].sort((a,b) => b.score - a.score);
    document.getElementById("score-body").innerHTML = ranked.map(p => `<div class="player-row"><b>${p.name}</b><span>${p.score} PTS</span></div>`).join("");
    document.getElementById("modal-score").style.display = "flex";
}

function show(id){ document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active")); document.getElementById(id).classList.add("active"); }
function openModal(id){ document.getElementById(id).style.display = "flex"; }
function closeModal(id){ document.getElementById(id).style.display = "none"; }
function toggleAudio() { initAudio(); isMuted = !isMuted; document.getElementById("sound-btn").innerText = isMuted ? "üîá" : "üîä"; }
</script>
</body>
</html>
